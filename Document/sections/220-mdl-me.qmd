## Measurement error{#sec-me}

In this exercise, measurement error in locations is introduced. Measurement error is modeled as disturbance of the locations, where the disturbances are centered at zero and are not greater than a pre-specified percentage of the radius of a circle. The radius of the disturbances are 1, 2, and 3 percent the length of the unit circle.

Likewise, this exercise evaluates how the rejection frequencies of the different inference methods change when the average pairwise correlation $\bar\rho$ of the true DGP varies. Of particular interest is the response of the MW's method, as it relies on a pre-specified maximum value $\bar\rho_{max}$ that should be provided by the practitioner beforehand; the default value is 0.03.

![ME in locations, 30%]("../Simulations/Products/hist_dist_me_30p.png"){#fig-loc-me fig-scap="Histogram of distances using true and mismeasured locations when ME is 30 percent."}

Tables [-@tbl-no-me-r-10p and -@tbl-no-me-r-1p] display the results when there is no measurement error and the true $\bar\rho$ is above (0.10) MW's method default value (0.03) or below (0.01). Tables [-@tbl-me-3p-r-10p and -@tbl-me-3p-r-1p] show the same exercise but when the locations are mismeasured and the radius of the disturbances are 3% the length of the unit circle.

In @tbl-no-me-r-10p, when there is no ME and the $\bar\rho$ is significantly greater (0.10) than the $\bar\rho_{max}$ provided (0), the rejection frequencies of the C-SCPC and SCPC for the constant increase to 12 and 14 percent. For the slope SCPC is 6 and C-SCPC 4 percent; not much difference. This is consistent with what @Muller2022JBES report in their paper. They argue that the C-SCPC rejection frequency depends on the spatial correlation of $u=x'e$, which might be substantially lower than the spatial correlation of $e$; but when $x=1$, $u=e$, hence the higher rejection frequencies of the constant. Moreover, the length of the Confidence Interval increases from 0.5, when $\bar\rho$ is not misspecified, to 0.7, in the case of the slope, and from 0.8 to 1.0 for the constant. 

Unsurprisingly, when the $\bar\rho$ is lower (0.01) than the $\bar\rho_{max}$ (0.03), the rejection frequencies and the CI lengths decrease significantly. In @tbl-no-me-r-1p, the slope rejection frequencies of the SCPC and C-SCPC decrease from 0.4 of the no misspecification case, to 3.7 and 3 percent. The slope C.I. lengths of both decrease from 0.5 to 0.4. The constant rejection frequencies of SCPC goes down from 5 to 3 and of C-SCPC from 4 to 3 percent.

When the radius of the disturbances is 3 percent, the rejection frequencies of the SCPC and C-SCPC increase significantly for the constant but modestly for the slope [@tbl-me-3p-r-10p; @tbl-me-3p-r-1p]. Whereas for the CI lengths, they both almost remain unchanged.



```{r}
#| label: tbl-no-me-r-10p
#| tbl-cap: Rejection frequencies for different variance estimators. Spatial data with independent uniform-distributed two-dimension mismeasured locations. Selecting the number of B Splines using the lowest Nearest Neighbour (NN) correlation in residuals from a grid going from 4 to 12 PCs. No ME. DGP's $\bar\rho$ is 0.10. C-SCPC/SCPC $\bar\rho_{max}$ is 0.03.
#| echo: false
#| warning: false
#| eval: true
#| include: true

kernel_results <- read.csv("../Simulations/Products/opt_spline_sims_res_no_me_true_rho_10p.csv")

e_ar1_tbl <- read.csv("../Simulations/Products/opt_spline_sims_ar1_no_me_true_rho_10p.csv")

# notes <- c(rep("",5),"$^a$",rep("",9),"$^b$")
row_names_kernel<- c(
    "HR",
    "SCPC",
    "C-SCPC",
    rep(
        c(
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050"#,
            # "Damian's"
        ),
        1
    ),
        rep(
        c(
            "HR",
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050",
            "Damian's "

        ),
        1
    )
)
# row_names_kernel_notes <-paste0(row_names_kernel,notes)
aux <- c(
    rep(
        "",
        4+2
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        each = 5
    )
)

table_kernel <- cbind(
    aux,
    row_names_kernel, 
    kernel_results#, 
)
names(table_kernel)<- c(
    "Splines",
    "Estimator",
    "Cons.",
    "$\\beta_1$",
    "Cons. ",
    "$\\beta_1$ ",
    "$i$"
)

aux2 <- c(
    rep(
        "",
        1
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        1
    )
)

table_ar1 <-cbind(
    aux2,
    e_ar1_tbl
)
names(table_ar1)<-c(
    "Splines",
    "NN",
    "Slope",
    "BIC",
    "Damian's",
    "Dropped"
)
table<-merge(table_kernel,table_ar1, by="Splines",sort=FALSE)

kbl(
    table[,-c(9,11)], #- id, 
    digits=3,#c(3,3,5,3), 
    booktabs = TRUE,
    longtable = TRUE,
    # col.names = col_names,
    # row.names = row_names,
    escape = F,
    position = "p"#,
    # format.args = list(scientific=TRUE)
    ) %>%
    add_header_above(
        c(" "=4,"C.I. length"=2)
    ) %>%
    add_header_above(
        c(" "=1,"Spatial data"=6,"Residuals"=3)
    ) %>%
    collapse_rows(
        c(1,8:10),
        latex_hline = "custom",
        custom_latex_hline = 1,
        valign = "top"#,
        # row_group_label_position = "stack"
    ) #%>%

```



```{r}
#| label: tbl-no-me-r-1p
#| tbl-cap: Rejection frequencies for different variance estimators. Spatial data with independent uniform-distributed two-dimension mismeasured locations. Selecting the number of B Splines using the lowest Nearest Neighbour (NN) correlation in residuals from a grid going from 4 to 12 PCs. No ME. DGP's $\bar\rho$ is 0.01. C-SCPC/SCPC $\bar\rho_{max}$ is 0.03.
#| echo: false
#| warning: false
#| eval: true
#| include: true

kernel_results <- read.csv("../Simulations/Products/opt_spline_sims_res_no_me_true_rho_1p.csv")

e_ar1_tbl <- read.csv("../Simulations/Products/opt_spline_sims_ar1_no_me_true_rho_1p.csv")

# notes <- c(rep("",5),"$^a$",rep("",9),"$^b$")
row_names_kernel<- c(
    "HR",
    "SCPC",
    "C-SCPC",
    rep(
        c(
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050"#,
            # "Damian's"
        ),
        1
    ),
        rep(
        c(
            "HR",
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050",
            "Damian's "

        ),
        1
    )
)
# row_names_kernel_notes <-paste0(row_names_kernel,notes)
aux <- c(
    rep(
        "",
        4+2
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        each = 5
    )
)

table_kernel <- cbind(
    aux,
    row_names_kernel, 
    kernel_results#, 
)
names(table_kernel)<- c(
    "Splines",
    "Estimator",
    "Cons.",
    "$\\beta_1$",
    "Cons. ",
    "$\\beta_1$ ",
    "$i$"
)

aux2 <- c(
    rep(
        "",
        1
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        1
    )
)

table_ar1 <-cbind(
    aux2,
    e_ar1_tbl
)
names(table_ar1)<-c(
    "Splines",
    "NN",
    "Slope",
    "BIC",
    "Damian's",
    "Dropped"
)
table<-merge(table_kernel,table_ar1, by="Splines",sort=FALSE)

kbl(
    table[,-c(9,11)], #- id, 
    digits=3,#c(3,3,5,3), 
    booktabs = TRUE,
    longtable = TRUE,
    # col.names = col_names,
    # row.names = row_names,
    escape = F,
    position = "p"#,
    # format.args = list(scientific=TRUE)
    ) %>%
    add_header_above(
        c(" "=4,"C.I. length"=2)
    ) %>%
    add_header_above(
        c(" "=1,"Spatial data"=6,"Residuals"=3)
    ) %>%
    collapse_rows(
        c(1,8:10),
        latex_hline = "custom",
        custom_latex_hline = 1,
        valign = "top"#,
        # row_group_label_position = "stack"
    ) #%>%

```



```{r}
#| label: tbl-me-3p-r-10p
#| tbl-cap: Rejection frequencies for different variance estimators. Spatial data with independent uniform-distributed two-dimension mismeasured locations. Selecting the number of B Splines using the lowest Nearest Neighbour (NN) correlation in residuals from a grid going from 4 to 12 PCs. ME is 0.03. DGP's $\bar\rho$ is 0.10. C-SCPC/SCPC $\bar\rho_{max}$ is 0.03.
#| echo: false
#| warning: false
#| eval: true
#| include: true

kernel_results <- read.csv("../Simulations/Products/opt_spline_sims_res_me_3p_true_rho_10p.csv")

e_ar1_tbl <- read.csv("../Simulations/Products/opt_spline_sims_ar1_me_3p_true_rho_10p.csv")

# notes <- c(rep("",5),"$^a$",rep("",9),"$^b$")
row_names_kernel<- c(
    "HR",
    "SCPC",
    "C-SCPC",
    rep(
        c(
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050"#,
            # "Damian's"
        ),
        1
    ),
        rep(
        c(
            "HR",
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050",
            "Damian's "

        ),
        1
    )
)
# row_names_kernel_notes <-paste0(row_names_kernel,notes)
aux <- c(
    rep(
        "",
        4+2
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        each = 5
    )
)

table_kernel <- cbind(
    aux,
    row_names_kernel, 
    kernel_results#, 
)
names(table_kernel)<- c(
    "Splines",
    "Estimator",
    "Cons.",
    "$\\beta_1$",
    "Cons. ",
    "$\\beta_1$ ",
    "$i$"
)

aux2 <- c(
    rep(
        "",
        1
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        1
    )
)

table_ar1 <-cbind(
    aux2,
    e_ar1_tbl
)
names(table_ar1)<-c(
    "Splines",
    "NN",
    "Slope",
    "BIC",
    "Damian's",
    "Dropped"
)
table<-merge(table_kernel,table_ar1, by="Splines",sort=FALSE)

kbl(
    table[,-c(9,11)], #- id, 
    digits=3,#c(3,3,5,3), 
    booktabs = TRUE,
    longtable = TRUE,
    # col.names = col_names,
    # row.names = row_names,
    escape = F,
    position = "p"#,
    # format.args = list(scientific=TRUE)
    ) %>%
    add_header_above(
        c(" "=4,"C.I. length"=2)
    ) %>%
    add_header_above(
        c(" "=1,"Spatial data"=6,"Residuals"=3)
    ) %>%
    collapse_rows(
        c(1,8:10),
        latex_hline = "custom",
        custom_latex_hline = 1,
        valign = "top"#,
        # row_group_label_position = "stack"
    ) #%>%

```



```{r}
#| label: tbl-me-3p-r-1p
#| tbl-cap: Rejection frequencies for different variance estimators. Spatial data with independent uniform-distributed two-dimension mismeasured locations. Selecting the number of B Splines using the lowest Nearest Neighbour (NN) correlation in residuals from a grid going from 4 to 12 PCs. ME is 0.03. DGP's $\bar\rho$ is 0.01. C-SCPC/SCPC $\bar\rho_{max}$ is 0.03.
#| echo: false
#| warning: false
#| eval: true
#| include: true

kernel_results <- read.csv("../Simulations/Products/opt_spline_sims_res_me_3p_true_rho_1p.csv")

e_ar1_tbl <- read.csv("../Simulations/Products/opt_spline_sims_ar1_me_3p_true_rho_1p.csv")

# notes <- c(rep("",5),"$^a$",rep("",9),"$^b$")
row_names_kernel<- c(
    "HR",
    "SCPC",
    "C-SCPC",
    rep(
        c(
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050"#,
            # "Damian's"
        ),
        1
    ),
        rep(
        c(
            "HR",
            "Kernel 0.015",
            "Kernel 0.030",
            "Kernel 0.050",
            "Damian's "

        ),
        1
    )
)
# row_names_kernel_notes <-paste0(row_names_kernel,notes)
aux <- c(
    rep(
        "",
        4+2
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        each = 5
    )
)

table_kernel <- cbind(
    aux,
    row_names_kernel, 
    kernel_results#, 
)
names(table_kernel)<- c(
    "Splines",
    "Estimator",
    "Cons.",
    "$\\beta_1$",
    "Cons. ",
    "$\\beta_1$ ",
    "$i$"
)

aux2 <- c(
    rep(
        "",
        1
    ),
    rep(
        c(
            "Order 1"#,
            # "Order 2"
        ),
        1
    )
)

table_ar1 <-cbind(
    aux2,
    e_ar1_tbl
)
names(table_ar1)<-c(
    "Splines",
    "NN",
    "Slope",
    "BIC",
    "Damian's",
    "Dropped"
)
table<-merge(table_kernel,table_ar1, by="Splines",sort=FALSE)

kbl(
    table[,-c(9,11)], #- id, 
    digits=3,#c(3,3,5,3), 
    booktabs = TRUE,
    longtable = TRUE,
    # col.names = col_names,
    # row.names = row_names,
    escape = F,
    position = "p"#,
    # format.args = list(scientific=TRUE)
    ) %>%
    add_header_above(
        c(" "=4,"C.I. length"=2)
    ) %>%
    add_header_above(
        c(" "=1,"Spatial data"=6,"Residuals"=3)
    ) %>%
    collapse_rows(
        c(1,8:10),
        latex_hline = "custom",
        custom_latex_hline = 1,
        valign = "top"#,
        # row_group_label_position = "stack"
    ) #%>%

```
