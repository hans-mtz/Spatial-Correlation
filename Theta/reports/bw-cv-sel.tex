% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% \usepackage[figon, printfigures]{figcaps}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Bandwidth and Critical Values Selection},
  pdfauthor={Hans Martinez},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Bandwidth and Critical Values Selection}
\author{Hans Martinez}
\date{2025-08-21}

\begin{document}
\maketitle

\section{Bandwidth and Critical Values
Selection}\label{bandwidth-and-critical-values-selection}

\subsection{Data Generating Process}\label{data-generating-process}

The data generating process (DGP) is as follows: \[
\begin{aligned}
    y_l, x_l &\sim (1-\rho)\epsilon_l +\rho \eta_l \\
    \epsilon_l &\sim N(0,1) \\
    \eta_l &\sim \mathcal{G}(\theta)
\end{aligned}
\]

\((y_l,x_l,\epsilon_l,\eta_l)\) are associated with observed spatial
location \(s_l \in \mathbb{R}^2\). \(\epsilon\) is a white noise
independent of \(s_l\). \(\eta\) is generated by a Gaussian process with
covariance function
\(cov(s_l,s_{l}')=\exp(-\theta^{-1}||s_l-s_{l}'||)\). The parameter
\(\rho\in[0,1)\) controls the spatial correlation of observations.

The parameter of the Gaussian process was set as \(\theta=\sqrt{2}/10\).
Locations \(s_l\) were drawn from the uniform Poisson process inside the
unit square, two for each observation. I kept using Morgan's locations.
I used 500 observations of each variable \((y_l,x_l,s_l)\).

The regression model used is

\[
    y_l=\beta x_l + u_l 
\]

because \(y_l\) and \(x_l\) are independent draws from the same DGP, the
true parameter is \(\beta=0\).

\subsection{Critical Values and Bandwidth
Selection}\label{critical-values-and-bandwidth-selection}

For a value of \(\rho\), I simulate data from the DGP described above.
From the simulated data and the given number of PCs of the 10x10
triangular B-Splines, I estimated \(\tau = (\tau_0, \tau_1)\) from the
following model:

\[
  \hat\tau = \arg \max \left\{ -\frac{1}{2} \log\det(\Sigma(\tau))-\frac{1}{2}\hat\varepsilon'\Sigma(\tau)^{-1}\hat\varepsilon \right\}
\]

where \(\hat\varepsilon_l = y_l - \hat\beta x_l\).
\(\Sigma(\tau)=\exp(\tau_0)\exp(-\tau_1\cdot D)\), where
\(D_{s_l,s_l'}=||s_l - s_l'||\) is the matrix of the euclidean distances
between the locations \(s_l\) and \(s_{l'}\).

After estimating \(\hat\tau\), I simulated 1000 times from
\(\varepsilon_{sim} \sim N(0,\Sigma(\hat\tau))\) and generated
\(y_{sim }= \beta_{cand} x_l  + \varepsilon_{sim}\) for each value of
\(\beta_{cand} = \{-3/\sqrt{n}, 3/\sqrt{n}\}\) and \(n=500\).

I tested the null hypothesis \(H_0: \beta = 0\) against the alternative
\(H_1: \beta \not= 0\) forming the statistic

\[
t_{sim} = \frac{\hat\beta}{\hat\sigma(h)_{\hat\beta}/\sqrt{n}}.
\]

I estimated \(\hat\sigma(h)_{\hat\beta}\) using the kernel HAC estimator
with bandwidth \(h\) for different values of
\(h=\{0.0, 0.025, 0.05, 0.075, 0.10, 0.125, 0.15\}\) and for different
numbers of PCs of the 10x10 B-splines,
\(sp = \{0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 99\}\). I used the PCs
to prewhiten the error term in each regression before estimating the
variance using the HAC estimator. In particular,
\(y_l=\beta x_l + w'\gamma+\varepsilon_l\). The number of PCs is the
number of columns of the matrix \(w\).

The critical values were selected as the 95\% quantile of the empirical
distribution of the absolute value of the \(t_{sim}\) statistics when
the \(\beta_{cand} = 0\). I repeated this process for each pair of
bandwidth \(h\) and number \(sp\) of PCs of the 10x10 B-splines.

For each pair, I estimated the mean power as the average of the
probabilities of rejecting the null hypothesis using the critical values
described above when testing \(H_0: \beta = 0\) for every
\(\beta_{cand}\). The probability of rejection for each \(\beta_{cand}\)
is estimated from the empirical distribution of the simulated statistics
of that \(\beta_{cand}\) and pair \((h,sp)\).

Finally, I used the pair \((h,sp)\) that maximized the mean power across
all \(\beta_{cand}\) to test the null hypothesis \(H_0: \beta = 0\) with
the original simulated data. I repeated this process 1000 times for each
value of \(\rho\), and recorded the number of times I rejected the null
hypothesis and the length of the confidence intervals.

Table~\ref{tbl-mc-all} shows the rejection frequencies and average CI
lengths for the 1000 MC simulations.

\begin{table}

\caption{\label{tbl-mc-all}Rejection frequencies and Confidence Interval
lenths for all Monte Carlo simulations.}

\centering{

\begin{tabular}{rrrr}
\toprule
$\rho$ & Corr. & Rej. F. & CI Length\\
\midrule
0.0 & 0.00 & 0.04 & 0.18\\
0.1 & 0.05 & 0.05 & 0.18\\
0.2 & 0.10 & 0.07 & 0.18\\
0.3 & 0.15 & 0.12 & 0.18\\
0.4 & 0.20 & 0.12 & 0.19\\
\addlinespace
0.5 & 0.25 & 0.12 & 0.20\\
0.6 & 0.30 & 0.09 & 0.20\\
0.7 & 0.35 & 0.06 & 0.21\\
0.8 & 0.39 & 0.04 & 0.22\\
0.9 & 0.44 & 0.04 & 0.23\\
\addlinespace
1.0 & 0.49 & 0.05 & 0.26\\
\bottomrule
\end{tabular}

}

\end{table}%



\end{document}
