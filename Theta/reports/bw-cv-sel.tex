% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% \usepackage[figon, printfigures]{figcaps}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Bandwidth and Critical Values Selection},
  pdfauthor={Hans Martinez},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Bandwidth and Critical Values Selection}
\author{Hans Martinez}
\date{2025-06-18}

\begin{document}
\maketitle

\section{Bandwidth and Critical Values
Selection}\label{bandwidth-and-critical-values-selection}

\subsection{Data Generating Process}\label{data-generating-process}

Preliminary results from the simulations with 40 PCs of the 10x10
B-splines, for different bandwidths
\(h \in \{0.01, 0.02, \dots, 0.09, 0.10\}\).

Data was generated from the following data generating process (DGP): \[
\begin{aligned}
    y_l, x_l &\sim (1-\rho)\epsilon_l +\rho \eta_l \\
    \epsilon_l &\sim N(0,1) \\
    \eta_l &\sim \mathcal{G}(\theta)
\end{aligned}
\]

\((y_l,x_l,\epsilon_l,\eta_l)\) are associated with observed spatial
location \(s_l \in \mathbb{R}^2\). \(\epsilon\) is a white noise
independent of \(s_l\). \(\eta\) is generated by a Gaussian process with
covariance function
\(cov(s_l,s_{l}')=\exp(-\theta^{-1}||s_l-s_{l}'||)\). The parameter
\(\rho\in[0,1)\) controls the spatial correlation of observations.

The parameter of the Gaussian process was set as \(\theta=\sqrt{2}/10\).
Locations \(s_l\) were drawn from the uniform Poisson process inside the
unit square, two for each observation. I kept using Morgan's locations.
I used 500 observations of each variable \((y_l,x_l,s_l)\).

The regression model used is

\[
    y_l=\beta x_l + u_l 
\]

because \(y_l\) and \(x_l\) are independent draws from the same DGP, the
true parameter is \(\beta=0\).

\subsection{Critical Values and Bandwidth
Selection}\label{critical-values-and-bandwidth-selection}

From the simulated data and the given number of PCs of the 10x10
triangular B-Splines, I estimated \(\tau = (\tau_0, \tau_1)\) from the
following model:

\[
  \hat\tau = \arg \max \left\{ -\frac{1}{2} \log\det(\Sigma(\tau))-\frac{1}{2}\hat\varepsilon'\Sigma(\tau)^{-1}\hat\varepsilon \right\}
\]

where \(\hat\varepsilon_l = y_l - \hat\beta x_l-w'\hat\gamma\). \(w\) is
the matrix of the PCs of the 10x10 B-Spline.
\(\Sigma(\tau)=\exp(\tau_0\cdot I_n)\exp(\tau_1\cdot D)\), where
\(D_{s_l,s_l'}=||s_l - s_l'||\) is the matrix of the euclidean distances
between the locations \(s_l\) and \(s_{l'}\).

After estimating \(\hat\tau\), I simulated 1000 times from
\(\varepsilon_{sim} \sim N(0,\Sigma(\hat\tau))\) and generated
\(y_{sim }= \beta_{cand} x_l  + w'\hat\gamma + \varepsilon_{sim}\) for
each value of
\(\beta_{cand} = \{-3/\sqrt{n}, -2/\sqrt{n}, \dots, 2/\sqrt{n}, 3/\sqrt{n}\}\),
with \(n=500\).

I tested the null hypothesis \(H_0: \beta = 0\) against the alternative
\(H_1: \beta \not= 0\) forming the statistic

\[
t_{sim} = \frac{\hat\beta}{\hat\sigma(h)_{\hat\beta}/\sqrt{n}} .
\]

I estimated \(\hat\sigma(h)_{\hat\beta}\) using the kernel HAC estimator
with bandwidth \(h\) for different values of
\(h=\{0.02, 0.04, \dots, 0.08, 0.10\}\).

The critical values were selected as the 2.5\% and 97.5\% quantile of
the empirical distribution of the \(t_{sim}\) statistics when the
\(\beta_{cand} = 0\). I repeated this process for each value of \(h\).
In this first exercise, I kept the number of PCs fixed at 40.

For each bandwidth \(h\), I estimated the mean power as the average of
the probabilities of rejecting the null hypothesis using the critical
values described above when testing \(H_0: \beta = 0\) for every
\(\beta_{cand}\). The probability of rejection for each \(\beta_{cand}\)
is estimated from the empirical distribution of the simulated statistics
of that \(\beta_{cand}\) and bandwidth.

Table~\ref{tbl-bw-cv-sel} shows the results of the simulations. The
table shows the bandwidth, the critical values for the statistic, and
the mean power of the test for each bandwidth.

This exercise took around 90 minutes to run on an intel MacBook Pro with
16GB of RAM.

\begin{table}

\caption{\label{tbl-bw-cv-sel}Bandwidth and Critical Values Selection
Results. Simulations with 40 PCs of the 10x10 B-splines, for different
bandwidths \(h=\{0.02, 0.04, \dots, 0.08, 0.10\}\).
\(\beta_{cand} = \{-3/\sqrt{n}, -2/\sqrt{n}, \dots, 2/\sqrt{n}, 3/\sqrt{n}\}\).
With \(n=500\) and 1000 simulations. The critical values are the 2.5\%
and 97.5\% quantiles of the empirical distribution of the simulated
statistics when testing the null hypothesis \(\beta = 0\) when the
\(\beta_{cand} = 0\). The mean power is the average of the probability
of rejecting the null hypothesis using the critical values described
above when testing \(\beta = 0\) for every \(\beta_{cand}\).}

\centering{

\begin{tabular}{rrrr}
\toprule
Bandwidth & CV Lower & CV Upper & Mean Power\\
\midrule
0.02 & -1.88 & 2.15 & 0.3757\\
0.04 & -1.88 & 2.15 & 0.3760\\
0.06 & -1.87 & 2.16 & 0.3759\\
0.08 & -1.87 & 2.16 & 0.3751\\
0.10 & -1.87 & 2.17 & 0.3735\\
\bottomrule
\end{tabular}

}

\end{table}%



\end{document}
